# Terraform AWS Інфраструктура - Урок 5

## Опис проєкту

Цей проєкт демонструє створення AWS інфраструктури за допомогою Terraform з використанням модульної архітектури. Проєкт включає налаштування віддаленого бекенду для зберігання стейту, створення мережевої інфраструктури VPC та репозиторію ECR для зберігання Docker-образів.

## Структура проєкту

```
lesson-5/
│
├── main.tf                  # Головний файл для підключення модулів
├── backend.tf               # Налаштування бекенду для стейтів (S3 + DynamoDB)
├── outputs.tf               # Загальне виведення ресурсів
│
├── modules/                 # Каталог з усіма модулями
│   │
│   ├── s3-backend/          # Модуль для S3 та DynamoDB
│   │   ├── s3.tf            # Створення S3-бакета
│   │   ├── dynamodb.tf      # Створення DynamoDB
│   │   ├── variables.tf     # Змінні для S3
│   │   └── outputs.tf       # Виведення інформації про S3 та DynamoDB
│   │
│   ├── vpc/                 # Модуль для VPC
│   │   ├── vpc.tf           # Створення VPC, підмереж, Internet Gateway
│   │   ├── routes.tf        # Налаштування маршрутизації
│   │   ├── variables.tf     # Змінні для VPC
│   │   └── outputs.tf       # Виведення інформації про VPC
│   │
│   └── ecr/                 # Модуль для ECR
│       ├── ecr.tf           # Створення ECR репозиторію
│       ├── variables.tf     # Змінні для ECR
│       └── outputs.tf       # Виведення URL репозиторію ECR
│
└── README.md                # Документація проєкту
```

## Команди для ініціалізації та запуску

### Початкове розгортання

```bash
# Ініціалізація Terraform
terraform init

# Перегляд планованих змін
terraform plan

# Застосування конфігурації
terraform apply

# Видалення всієї інфраструктури
terraform destroy
```

### Налаштування віддаленого бекенду

Після початкового розгортання для активації віддаленого бекенду:

1. Розкоментуйте конфігурацію бекенду в файлі `backend.tf`
2. Виконайте міграцію стейту:

```bash
terraform init -migrate-state
```

## Пояснення модулів

### Модуль `s3-backend`

**Призначення:** Створення інфраструктури для зберігання стейту Terraform.

**Створювані ресурси:**
- **S3 бакет** для зберігання файлів стейту Terraform
- **Версіювання** для збереження історії змін стейту
- **Шифрування** даних у бакеті (AES256)
- **Блокування публічного доступу** для безпеки
- **DynamoDB таблиця** для блокування стейту під час операцій

**Основні функції:**
- Централізоване зберігання стейту
- Запобігання одночасним змінам інфраструктури
- Збереження історії всіх змін
- Забезпечення безпеки даних

### Модуль `vpc`

**Призначення:** Створення мережевої інфраструктури AWS.

**Створювані ресурси:**
- **VPC** з CIDR блоком 10.0.0.0/16
- **3 публічні підмережі** (10.0.1.0/24, 10.0.2.0/24, 10.0.3.0/24)
- **3 приватні підмережі** (10.0.4.0/24, 10.0.5.0/24, 10.0.6.0/24)
- **Internet Gateway** для доступу публічних підмереж до інтернету
- **3 NAT Gateway** для безпечного доступу приватних підмереж до інтернету
- **Elastic IP адреси** для NAT Gateway
- **Таблиці маршрутизації** та їх асоціації з підмережами

**Основні функції:**
- Ізоляція мережевого трафіку
- Розподіл ресурсів між зонами доступності
- Безпечний доступ до інтернету для приватних ресурсів
- Масштабованість інфраструктури

### Модуль `ecr`

**Призначення:** Створення репозиторію для зберігання Docker-образів.

**Створювані ресурси:**
- **ECR репозиторій** з можливістю зміни тегів
- **Автоматичне сканування образів** на вразливості
- **Політика життєвого циклу** для управління зберіганням образів
- **Теги** для організації та ідентифікації

**Основні функції:**
- Безпечне зберігання Docker-образів
- Автоматичне сканування безпеки
- Управління версіями образів
- Інтеграція з іншими AWS сервісами

## Важливі примітки

### Безпека
- S3 бакет має увімкнене шифрування та заблокований публічний доступ
- ECR репозиторій має увімкнене сканування образів
- Приватні підмережі мають доступ до інтернету тільки через NAT Gateway

### Витрати
- NAT Gateway генерують щомісячні витрати (~$45/місяць кожен)
- Elastic IP адреси безкоштовні при використанні
- S3 та DynamoDB мають мінімальні витрати при невеликому обсязі

### Відновлення після видалення
При використанні `terraform destroy` весь стейт також буде видалено. Для відновлення:

1. Закоментуйте конфігурацію бекенду в `backend.tf`
2. Виконайте `terraform init`
3. Застосуйте конфігурацію `terraform apply`
4. Розкоментуйте бекенд і виконайте `terraform init -reconfigure`

## Регіон розгортання

Проєкт налаштований для регіону **Europe (Stockholm) eu-north-1**.

---


